<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>VoidJS</title>

		<link href="/css/bootstrap.min.css" rel="stylesheet">
		<link href="/css/custom.css" rel="stylesheet">
		<link href="/css/font-awesome.min.css" rel="stylesheet">
		<link href="/img/favicon.ico" rel="shortcut icon">
	</head>
	<body data-spy="scroll" data-target=".navbar-example">

		<section id="utility" class="hidden-xs hidden-sm">
			<div class="container">
				<div class="row">
					<div class="col-md-offset-1 col-md-10 text-right">
						<ul class="list-inline">
							<li><a href="https://github.com/edj-boston/void">Github</a></li>
							<li><a href="https://github.com/edj-boston/void/issues">Issues</a></li>
							<li><a href="https://github.com/edj-boston/void/wiki">Wiki</a></li>
						</ul>
					</div>
				</div>
			</div>
		</section>

		<header>
			<div class="container">
				<div class="row">
					<div id="banner" class="col-md-offset-1 col-md-10">
						<h1>Void<span>JS</span></h1>
					</div>
				</div>
			</div>
		</header>

		<section id="bar">
			<div class="container">
				<div class="row">
					<div class="col-md-offset-1 col-md-10">
						<ul id="buttons" class="list-inline">
							<li><a href="https://twitter.com/share" class="twitter-share-button">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
							<li class="hidden-xs"><a href="https://twitter.com/edjboston" class="twitter-follow-button" data-show-count="true">Follow @edjboston</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
							<li><iframe src="/inc/github-btn.html?user=edj-boston&amp;repo=void&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe></li>
							<li class="hidden-xs"><iframe src="/inc/github-btn.html?user=edj-boston&amp;repo=void&amp;type=fork&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe></li>
							<li class="hidden-xs"><iframe src="/inc/github-btn.html?user=edj-boston&amp;type=follow&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="165" height="20"></iframe></li>
						</ul>
					</div>
				</div>
			</div>
		</section>

		<main class="container">
			<div class="row">
				<div class="col-md-offset-1 col-md-2 hidden-xs hidden-sm">
					<div class="navbar-example" data-spy="affix" data-offset-top="255">
						<ul class="nav nav-pills nav-stacked">
							<li><a href="#installation">Installation</a></li>
							<li><a href="#usage">Usage</a></li>
							<li><a href="#arguments">Arguments</a></li>
							<li><a href="#properties">Properties</a></li>
							<li><a href="#example">Example</a></li>
							<li><a href="#tests">Tests</a></li>
							<li><a href="#notes">Notes</a></li>
							<li><a href="#roadmap">Roadmap</a></li>
						</ul>
					</div>
				</div>
				<div id="main" class="col-md-8">

					<p><a href="https://github.com/edj-boston/void">Void</a> is a NodeJS <a href="https://www.npmjs.org/package/void">module</a> that intelligently invalidates your CloudFront Cache. It respects the following limitations:</p>
					<ul>
						<li>Hard limit of 1000 paths per invalidation</li>
						<li>Only 3 invalidations can run at the same time (and other processes may be creating them too)</li>
						<li>There is no callback for the native AWS SDK, so the API must be polled</li>
					</ul>


					<h2 id="installation">Installation</h2>
					<pre><code>$ npm install void</code></pre>
					<p>Void relies on the <a href="https://www.npmjs.org/package/aws-sdk">AWS-SDK</a>, which requires that you set two environment variables:</p>
					<pre><code>AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY</code></pre>
					<p>You can <a href="http://www.cyberciti.biz/faq/linux-unix-shell-export-command/">export</a> them in the shell for local testing or permanent use. You can also load them into your environment using a tool like <a href="https://www.npmjs.org/package/supervisor">supervisor</a> or <a href="http://ddollar.github.io/foreman/">foreman</a> to load an .env file.</p>
					<p>Follow your hosting provider's instructions for setting environment variables in production:</p>
					<ul>
						<li><a href="https://devcenter.heroku.com/articles/nodejs-support#environment">Heroku</a></li>
						<li><a href="http://docs.aws.amazon.com/gettingstarted/latest/deploy/envvar.html">AWS Elastic Beanstalk</a></li>
					</ul>
					<p>Void requires a third environment variable that contains the CloudFront distribution id:</p>
					<pre><code>DISTRIBUTION_ID</code></pre>
					<p><strong>WARNING:</strong> Do <em>not</em> place your AWS credentials or CloudFront Distribution ID in source control!</p>


					<h2 id="usage">Usage</h2>
					<p>Require void at the top of your script.</p>
					<pre><code>var Void = require('void');</code></pre>
					<p>Call the constructor with the <code>new</code> keyword.</p>
					<pre><code>var v = new Void();</code></pre>
					<p><em>Note:</em> Use a capital "V" for the constructor and a single, lowercase "v" to avoid collision with the reserved word "void".</p>


					<h2 id="arguments">Arguments</h2>
					<ul>
						<li><strong>name:</strong> will default to a 5 character string for logging</li>
						<li><strong>distribution:</strong> will default to <code>process.env.DISTRIBUTION_ID</code></li>
						<li><strong>paths:</strong> Array of path strings to be cleared</li>
						<li><strong>dirs:</strong> Array of directories to be scanned and added to <code>paths</code></li>
						<li><strong>poison:</strong> Array of path strings to be removed from <code>paths</code></li>
						<li><strong>maxPaths:</strong> Max number of paths per invalidation (defaults to 1000)</li>
						<li><strong>maxJobs:</strong> Max number of simultaneous invalidations (defaults to 3)</li>
					</ul>


					<h2 id="properties">Properties</h2>
					<ul>
						<li><strong>queue:</strong> Queue of invalidations</li>
						<li><strong>cloudfront:</strong> The AWS-SDK object</li>
					</ul>


					<h2 id="example">Example</h2>
					<p>We can change the default <code>maxPaths</code> method to see some complex behavior:</p>
					<pre><code>var v = new Void({
	paths : [
	    '/index.html',
	    '/index2.html',
	    '/foo/bar.html',
	    '/foo2/bar2.html'
	],
	maxPaths : 1
});</code></pre>
					<p>This will result in the the following console output:</p>
					<pre><code>[Void:IWZ33] Created 4 item(s) in the queue
[Void:IWZ33][Job:H27NL] Invalidation "IVBLZ2PCXZL5Q" created. Checking in 10 minute(s)...
[Void:IWZ33][Job:JD9ZU] Invalidation "I35PDGSFYBCA1X" created. Checking in 10 minute(s)...
[Void:IWZ33][Job:H1C3R] Too many invalidations, retrying in 2 minute(s)
[Void:IWZ33][Job:H1C3R] Too many invalidations, retrying in 2 minute(s)
[Void:IWZ33][Job:H1C3R] Too many invalidations, retrying in 2 minute(s)
[Void:IWZ33][Job:H1C3R] Too many invalidations, retrying in 2 minute(s)
[Void:IWZ33][Job:H1C3R] Too many invalidations, retrying in 2 minute(s)
[Void:IWZ33][Job:H27NL] In progress, re-checking in 2 minute(s)...
[Void:IWZ33][Job:JD9ZU] In progress, re-checking in 2 minute(s)...
[Void:IWZ33][Job:H1C3R] Too many invalidations, retrying in 2 minute(s)
[Void:IWZ33][Job:H27NL] In progress, re-checking in 2 minute(s)...
[Void:IWZ33][Job:JD9ZU] In progress, re-checking in 2 minute(s)...
[Void:IWZ33][Job:H1C3R] Invalidation "I13B9HSQI6RO7J" created. Checking in 10 minute(s)...
[Void:IWZ33][Job:JD9ZU] Invalidation "I35PDGSFYBCA1X" completed!
[Void:IWZ33][Job:H27NL] Invalidation "IVBLZ2PCXZL5Q" completed!
[Void:IWZ33][Job:7BTD7] Invalidation "I3HRQCLJU7OSZ7" created. Checking in 10 minute(s)...
[Void:IWZ33][Job:H1C3R] Invalidation "I13B9HSQI6RO7J" completed!
[Void:IWZ33][Job:7BTD7] In progress, re-checking in 2 minute(s)...
[Void:IWZ33][Job:7BTD7] Invalidation "I3HRQCLJU7OSZ7" completed!
[Void:IWZ23] All jobs complete!</code></pre>

					<h2 id="tests">Tests</h2>
					<p>Install the global dependancies with sudo permissions.</p>
					<pre><code>$ sudo npm install -g mocha
$ sudo npm install -g should</code></pre>
					<p>Run mocha directly to see the test results.</p>
					<pre><code>$ cd void
$ mocha</code></pre>
					<p><strong>WARNING:</strong> Tests will fail unless you have the <code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, and <code>DISTRIBUTION_ID</code> variables configured in your environment!</p>

					<h2 id="notes">Notes</h2>
					<ol>
						<li>You may incur charges if you invalidate your CloudFront cache frequently. Please see their <a class="external" href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Invalidation.html#PayingForInvalidation">documentation</a> and pricing.</li>
						<li>Againâ€¦ do NOT put your AWS credentials or CloudFront distribution id in source control</li>
					</ol>


					<h2 id="roadmap">Roadmap</h2>
					<ol>
						<li>More tests</li>
						<li>Surface granual <code>Job</code> properties in <code>Void</code> constructor for more flexibility</li>
						<li><code>Void</code> event callbacks</li>
						<li>Document <code>Job</code> object</li>
					</ol>

				</div>
			</div>
		</main>

		<footer class="container">
			<div class="row">
				<div class="col-md-offset-2 col-md-8">
					<ul class="list-unstyled list-inline">
						<li>&copy; 2014 <a class="external" href="https://github.com/edj-boston">edj</a></li>
						<li><i class="fa fa-github"></i> <a class="external" href="https://github.com/edj-boston/void">source</a></li>
					</ul>
				</div>
			</div>
		</footer>

		<script src="/js/jquery-1.11.0.min.js"></script>
		<script src="/js/bootstrap.min.js"></script>
		<script src="/js/custom.js"></script>
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-16075338-10', 'voidjs.com');
			ga('send', 'pageview');
		</script>
	</body>
</html>